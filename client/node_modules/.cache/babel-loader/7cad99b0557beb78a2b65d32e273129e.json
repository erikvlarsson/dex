{"ast":null,"code":"import _regeneratorRuntime from\"/Users/erik/Desktop/Software/dex/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/erik/Desktop/Software/dex/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/erik/Desktop/Software/dex/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useState,useEffect,createContext}from\"react\";import AuthService from\"../Shared/AuthService\";export var AuthContext=/*#__PURE__*/createContext(null);export var AuthContextProvider=function AuthContextProvider(_ref){var children=_ref.children;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),authenticated=_useState2[0],setAuthenticated=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),hasLoaded=_useState4[0],setHasLoaded=_useState4[1];var setAuth=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(bool){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAuthenticated(bool);case 1:case\"end\":return _context.stop();}}},_callee);}));return function setAuth(_x){return _ref2.apply(this,arguments);};}();var logout=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setAuth(false).then(function(){localStorage.removeItem(\"refreshToken\");sessionStorage.removeItem(\"accessToken\");});case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function logout(){return _ref3.apply(this,arguments);};}();// Authentication when app launches\nuseEffect(function(){console.log(\"authUseEffect\");if(!hasLoaded){var authService=new AuthService();authService.getRefreshToken().then(function(auth){setAuth(auth).then(function(){if(auth){setTimeout(function(){return setHasLoaded(true);},1500);}else{logout().then(function(){setHasLoaded(true);});}});}).catch(function(){logout().then(function(){setHasLoaded(true);});});}// without the following line, useEffect is called twice.\n// eslint-disable-next-line\n},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{hasLoaded:hasLoaded,setAuth:setAuth,auth:authenticated,logout:logout},children:children});};","map":{"version":3,"sources":["/Users/erik/Desktop/Software/dex/client/src/Contexts/AuthContext.js"],"names":["React","useState","useEffect","createContext","AuthService","AuthContext","AuthContextProvider","children","authenticated","setAuthenticated","hasLoaded","setHasLoaded","setAuth","bool","logout","then","localStorage","removeItem","sessionStorage","console","log","authService","getRefreshToken","auth","setTimeout","catch"],"mappings":"kgBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,CAAqCC,aAArC,KAA0D,OAA1D,CACA,MAAOC,CAAAA,WAAP,KAAwB,uBAAxB,CACA,MAAO,IAAMC,CAAAA,WAAW,cAAGF,aAAa,CAAC,IAAD,CAAjC,CAEP,MAAO,IAAMG,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,eACTN,QAAQ,CAAC,KAAD,CADC,wCAC5CO,aAD4C,eAC7BC,gBAD6B,8BAEjBR,QAAQ,CAAC,KAAD,CAFS,yCAE5CS,SAF4C,eAEjCC,YAFiC,eAInD,GAAMC,CAAAA,OAAO,2FAAG,iBAAOC,IAAP,kHACdJ,gBAAgB,CAACI,IAAD,CAAhB,CADc,sDAAH,kBAAPD,CAAAA,OAAO,6CAAb,CAGA,GAAME,CAAAA,MAAM,2FAAG,wIACbF,OAAO,CAAC,KAAD,CAAP,CAAeG,IAAf,CAAoB,UAAM,CACxBC,YAAY,CAACC,UAAb,CAAwB,cAAxB,EACAC,cAAc,CAACD,UAAf,CAA0B,aAA1B,EACD,CAHD,EADa,wDAAH,kBAANH,CAAAA,MAAM,2CAAZ,CAOA;AACAZ,SAAS,CAAC,UAAM,CACdiB,OAAO,CAACC,GAAR,CAAY,eAAZ,EACA,GAAI,CAACV,SAAL,CAAgB,CACd,GAAMW,CAAAA,WAAW,CAAG,GAAIjB,CAAAA,WAAJ,EAApB,CACAiB,WAAW,CACRC,eADH,GAEGP,IAFH,CAEQ,SAACQ,IAAD,CAAU,CACdX,OAAO,CAACW,IAAD,CAAP,CAAcR,IAAd,CAAmB,UAAM,CACvB,GAAIQ,IAAJ,CAAU,CACRC,UAAU,CAAC,iBAAMb,CAAAA,YAAY,CAAC,IAAD,CAAlB,EAAD,CAA2B,IAA3B,CAAV,CACD,CAFD,IAEO,CACLG,MAAM,GAAGC,IAAT,CAAc,UAAM,CAClBJ,YAAY,CAAC,IAAD,CAAZ,CACD,CAFD,EAGD,CACF,CARD,EASD,CAZH,EAaGc,KAbH,CAaS,UAAM,CACXX,MAAM,GAAGC,IAAT,CAAc,UAAM,CAClBJ,YAAY,CAAC,IAAD,CAAZ,CACD,CAFD,EAGD,CAjBH,EAkBD,CACD;AACA;AACD,CAzBQ,CAyBN,EAzBM,CAAT,CA2BA,mBACE,KAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CACLD,SAAS,CAAEA,SADN,CAELE,OAAO,CAAEA,OAFJ,CAGLW,IAAI,CAAEf,aAHD,CAILM,MAAM,CAAEA,MAJH,CADT,UAQGP,QARH,EADF,CAYD,CAtDM","sourcesContent":["import React, { useState, useEffect, createContext } from \"react\";\nimport AuthService from \"../Shared/AuthService\";\nexport const AuthContext = createContext(null);\n\nexport const AuthContextProvider = ({ children }) => {\n  const [authenticated, setAuthenticated] = useState(false);\n  const [hasLoaded, setHasLoaded] = useState(false);\n\n  const setAuth = async (bool) => {\n    setAuthenticated(bool);\n  };\n  const logout = async () => {\n    setAuth(false).then(() => {\n      localStorage.removeItem(\"refreshToken\");\n      sessionStorage.removeItem(\"accessToken\");\n    });\n  };\n\n  // Authentication when app launches\n  useEffect(() => {\n    console.log(\"authUseEffect\");\n    if (!hasLoaded) {\n      const authService = new AuthService();\n      authService\n        .getRefreshToken()\n        .then((auth) => {\n          setAuth(auth).then(() => {\n            if (auth) {\n              setTimeout(() => setHasLoaded(true), 1500);\n            } else {\n              logout().then(() => {\n                setHasLoaded(true);\n              });\n            }\n          });\n        })\n        .catch(() => {\n          logout().then(() => {\n            setHasLoaded(true);\n          });\n        });\n    }\n    // without the following line, useEffect is called twice.\n    // eslint-disable-next-line\n  }, []);\n\n  return (\n    <AuthContext.Provider\n      value={{\n        hasLoaded: hasLoaded,\n        setAuth: setAuth,\n        auth: authenticated,\n        logout: logout,\n      }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}